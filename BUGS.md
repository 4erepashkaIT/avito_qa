# BUGS.md — Отчёт о найденных багах

## Сводка

| ID | Приоритет | Серьёзность | Компонент | Краткое описание |
|----|-----------|-------------|-----------|------------------|
| BUG-001 | Critical | Blocker | Документация / POST /api/1/item | Расхождение формата запроса между документацией и API |
| BUG-002 | High | Major | POST /api/1/item | API принимает отрицательные значения статистики |
| BUG-003 | Medium | Minor | GET /api/1/item/{id}, GET /api/1/statistic/{id} | API возвращает 400 вместо 404 для несуществующих ресурсов |
| BUG-004 | Low | Trivial | POST /api/1/item | Несогласованность именования полей (sellerID vs sellerId) |

---

## BUG-001: Расхождение формата запроса между документацией (Postman) и реальным API

**Приоритет:** Critical  
**Серьёзность:** Blocker  
**Компонент:** Документация API / POST /api/1/item  
**Статус:** Открыт

### Описание

Документация API (Postman collection) указывает, что поля статистики (`likes`, `viewCount`, `contacts`) должны передаваться внутри вложенного объекта `statistics`. Однако реальный API требует эти поля на **верхнем уровне** JSON-объекта.

Это критическая проблема, так как:
1. Разработчики не смогут интегрироваться с API, следуя документации
2. Любые клиенты, созданные по документации, будут получать ошибку `400 Bad Request`
3. Сообщение об ошибке: `"поле likes обязательно"`

### Шаги воспроизведения

**1. Запрос по документации (НЕ РАБОТАЕТ):**
```bash
curl -X POST https://qa-internship.avito.com/api/1/item \
  -H "Content-Type: application/json" \
  -d '{
    "sellerID": 123456,
    "name": "Тестовый товар",
    "price": 1000,
    "statistics": {
      "likes": 0,
      "viewCount": 0,
      "contacts": 0
    }
  }'
```

**Ответ:**
```json
{
  "result": {
    "message": "поле likes обязательно",
    "messages": {}
  },
  "status": "400"
}
```

**2. Рабочий формат запроса:**
```bash
curl -X POST https://qa-internship.avito.com/api/1/item \
  -H "Content-Type: application/json" \
  -d '{
    "sellerID": 123456,
    "name": "Тестовый товар",
    "price": 1000,
    "likes": 0,
    "viewCount": 0,
    "contacts": 0
  }'
```

**Ответ:**
```json
{
  "id": "uuid-xxx-xxx",
  "sellerId": 123456,
  "name": "Тестовый товар",
  "price": 1000,
  "createdAt": "2024-xx-xx",
  "statistics": {
    "likes": 0,
    "viewCount": 0,
    "contacts": 0
  }
}
```

### Ожидаемый результат

Один из вариантов:
1. API должен принимать формат из документации (вложенный объект `statistics`)
2. Документация должна быть обновлена с правильным форматом (поля на верхнем уровне)

### Фактический результат

- API требует поля `likes`, `viewCount`, `contacts` на верхнем уровне
- Документация показывает вложенный объект `statistics`

### Затронутые тест-кейсы

TC-001, TC-002, TC-003, TC-005, TC-006, TC-017, TC-022, TC-027, TC-031, TC-032, TC-033, TC-034, TC-035

### Рекомендация

**Срочно** обновить документацию Postman или исправить API для соответствия документации.

---

## BUG-002: API принимает отрицательные значения статистики

**Приоритет:** High  
**Серьёзность:** Major  
**Компонент:** POST /api/1/item  
**Тест-кейс:** TC-012  
**Статус:** Открыт

### Описание

API успешно создаёт объявления с отрицательными значениями в полях статистики (`likes`, `viewCount`, `contacts`), хотя это бизнес-логически невалидно. Количество лайков, просмотров и контактов не может быть отрицательным.

### Шаги воспроизведения

```bash
curl -X POST https://qa-internship.avito.com/api/1/item \
  -H "Content-Type: application/json" \
  -d '{
    "sellerID": 123456,
    "name": "Товар с отрицательной статистикой",
    "price": 1000,
    "likes": -10,
    "viewCount": -5,
    "contacts": -3
  }'
```

### Ожидаемый результат

- HTTP статус: `400 Bad Request`
- Сообщение об ошибке валидации с указанием на невалидные значения статистики

### Фактический результат

- HTTP статус: `200 OK`
- Объявление создано с отрицательными значениями статистики

### Влияние

- Нарушение целостности данных
- Возможные проблемы при отображении статистики на UI
- Некорректные бизнес-метрики и аналитика

### Рекомендация

Добавить валидацию:
```
likes >= 0
viewCount >= 0
contacts >= 0
```

---

## BUG-003: API возвращает 400 вместо 404 для несуществующих ресурсов

**Приоритет:** Medium  
**Серьёзность:** Minor  
**Компонент:** GET /api/1/item/{id}, GET /api/1/statistic/{id}  
**Тест-кейсы:** TC-018, TC-028  
**Статус:** Открыт

### Описание

При запросе несуществующего объявления или его статистики по ID, API возвращает HTTP статус `400 Bad Request` вместо семантически корректного `404 Not Found`.

Согласно REST-конвенциям:
- `400 Bad Request` — некорректный формат/синтаксис запроса
- `404 Not Found` — ресурс не найден (корректный запрос, но ресурс отсутствует)

### Шаги воспроизведения

```bash
# Запрос объявления
curl -X GET https://qa-internship.avito.com/api/1/item/nonexistent-id-12345

# Запрос статистики
curl -X GET https://qa-internship.avito.com/api/1/statistic/nonexistent-id-99999
```

### Ожидаемый результат

- HTTP статус: `404 Not Found`
- Тело ответа: информация о том, что ресурс не найден

### Фактический результат

- HTTP статус: `400 Bad Request`

### Влияние

- Некорректная семантика HTTP-кодов ответа
- Усложнение обработки ошибок на клиенте (нельзя отличить "не найдено" от "неправильный запрос")
- Нарушение REST-стандартов

### Рекомендация

Изменить HTTP-код ответа на `404 Not Found` для случаев, когда ресурс не найден, но формат запроса корректен.

---

## BUG-004: Несогласованность именования полей (sellerID vs sellerId)

**Приоритет:** Low  
**Серьёзность:** Trivial  
**Компонент:** POST /api/1/item  
**Статус:** Открыт

### Описание

В запросе на создание объявления используется поле `sellerID` (с заглавными буквами ID), а в ответе API возвращает поле `sellerId` (с маленькой буквой d). Это создаёт неконсистентность API.

### Шаги воспроизведения

**Запрос:**
```json
{
  "sellerID": 123456,
  "name": "Товар",
  "price": 1000,
  "likes": 0,
  "viewCount": 0,
  "contacts": 0
}
```

**Ответ:**
```json
{
  "id": "abc-123",
  "sellerId": 123456,
  "name": "Товар",
  "price": 1000,
  ...
}
```

### Ожидаемый результат

Единообразное именование полей во всём API:
- Либо везде `sellerID`
- Либо везде `sellerId` (рекомендуется для camelCase)

### Фактический результат

- В запросе: `sellerID`
- В ответе: `sellerId`

### Влияние

- Путаница при работе с API
- Необходимость маппинга имён полей на клиенте
- Потенциальные баги при автоматической десериализации

### Рекомендация

Унифицировать именование — использовать `sellerId` везде (стандартный camelCase).

---

## Статистика тестирования

| Метрика | Значение |
|---------|----------|
| Всего тестов | 35 |
| Пройдено | 22 |
| Провалено | 12 |
| Ошибки (ERROR) | 1 |
| Найдено уникальных багов | 4 |

### Распределение по компонентам

| Компонент | Пройдено | Провалено |
|-----------|----------|-----------|
| POST /api/1/item | 11 | 5 |
| GET /api/1/item/{id} | 4 | 1 |
| GET /api/1/{sellerID}/item | 4 | 1 |
| GET /api/1/statistic/{id} | 3 | 1 |
| Интеграционные | 0 | 5 |

### Причины падения тестов

1. **12 тестов** — падают из-за BUG-001 (неправильный формат в тестах по документации)
2. **1 тест (TC-012)** — помечен как `xfail` из-за BUG-002

### Примечание

После исправления BUG-001 (синхронизация документации и API) все 35 тестов должны проходить успешно.
